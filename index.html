<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Geeta Tech Hub — News Widget</title>
<style>
  :root{--gth-accent:#ff5b60;--gth-bg:#fff;--gth-muted:#777;--gth-radius:12px}
  html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;}
  .gth-wrap{max-width:980px;margin:12px auto;padding:12px}
  .gth-card{background:var(--gth-bg);border-radius:var(--gth-radius);box-shadow:0 8px 24px rgba(12,14,20,.06);overflow:hidden}
  .gth-header{display:flex;justify-content:space-between;align-items:center;padding:14px 16px}
  .gth-title{font-weight:700;font-size:18px;color:#111}
  .gth-sub{font-size:12px;color:var(--gth-muted)}
  .gth-layout{display:grid;gap:12px;padding:12px}
  .gth-featured{display:flex;gap:12px;align-items:flex-start;padding:12px;border-radius:10px;background:#fff}
  .gth-featured .img{flex:0 0 48%;max-height:260px;overflow:hidden;border-radius:10px}
  .gth-featured img{width:100%;height:100%;object-fit:cover;display:block}
  .gth-featured .meta{flex:1;display:flex;flex-direction:column;gap:8px}
  .gth-featured .headline{font-size:18px;font-weight:700;color:#111;line-height:1.15}
  .gth-featured .syn{font-size:14px;color:#222;line-height:1.4}
  .gth-featured .meta-row{display:flex;justify-content:space-between;align-items:center;color:var(--gth-muted);font-size:12px;margin-top:auto}
  .gth-featured a.read{border:1px solid var(--gth-accent);color:var(--gth-accent);padding:6px 10px;border-radius:8px;text-decoration:none;font-size:13px}
  .gth-sm-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:10px}
  .gth-sm{display:flex;gap:10px;align-items:flex-start;padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,0.04);background:#fff}
  .gth-sm .thumb{flex:0 0 86px;height:60px;border-radius:8px;overflow:hidden;background:#f2f2f2}
  .gth-sm img{width:100%;height:100%;object-fit:cover}
  .gth-sm .info{flex:1}
  .gth-sm .h{font-size:13px;font-weight:600;color:#111;margin-bottom:6px}
  .gth-sm .s{font-size:12px;color:var(--gth-muted)}
  .gth-footer{padding:10px 14px;font-size:12px;color:var(--gth-muted);text-align:right}
  .gth-loading{padding:24px;text-align:center;color:var(--gth-muted)}
  .gth-error{padding:20px;text-align:center;color:#b00020}
  @media(max-width:720px){.gth-featured{flex-direction:column}.gth-featured .img{width:100%;height:180px}}
</style>
</head>
<body>
  <div class="gth-wrap">
    <div id="gth-root" class="gth-card" aria-label="Geeta Tech Hub News Widget">
      <div class="gth-header">
        <div>
          <div class="gth-title">Geeta Tech Hub News</div>
          <div class="gth-sub">Google News + Trending searches • quick synopses</div>
        </div>
        <div class="gth-sub">Auto • Local</div>
      </div>
      <div id="gth-content" class="gth-layout">
        <div id="gth-loading" class="gth-loading">Loading headlines…</div>
      </div>
    </div>
  </div>

<script>
(async function(){
  const country = 'IN';
  const smallCount = 4;
  const newsRSS = `https://news.google.com/rss?hl=en-${country}&gl=${country}&ceid=${country}:en`;
  const trendsRSS = `https://trends.google.com/trends/trendingsearches/daily/rss?geo=${country}`;
  const proxy = url => 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);

  const contentEl = document.getElementById('gth-content');
  const loadingEl = document.getElementById('gth-loading');

  function stripHtml(html){ if(!html) return ''; const d = document.createElement('div'); d.innerHTML = html; return d.textContent||d.innerText||''; }
  function shortify(text, lim = 140){ if(!text) return ''; text = stripHtml(text).replace(/\s+/g,' ').trim(); if(text.length <= lim) return text; const s = text.slice(0, lim); const last = Math.max(s.lastIndexOf('.'), s.lastIndexOf('!'), s.lastIndexOf('?')); return last > 30 ? s.slice(0, last+1) : s + '…'; }
  function catchy(title, desc){ const d = shortify(desc, 160); const arr = [title + ' — quick take: ' + d, 'Why it matters: ' + d, title + ' — in brief: ' + d, 'Snapshot: ' + d]; return arr[Math.floor(Math.random() * arr.length)]; }
  function escapeHtml(s){ if(!s) return ''; return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;'); }

  // fallback SVG dataURL (encoded safely)
  function fallbackSvgDataUrl(){
    const svg = "<svg xmlns='http://www.w3.org/2000/svg' width='200' height='120'><rect width='100%' height='100%' fill='%23f2f2f2'/><text x='50%' y='50%' dominant-baseline='middle' text-anchor='middle' fill='%23999' font-size='12'>No image</text></svg>";
    return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
  }

  function parseRSS(xmlString){
    const parser = new DOMParser();
    const doc = parser.parseFromString(xmlString, 'application/xml');
    const nodeErr = doc.querySelector('parsererror');
    if(nodeErr) {
      console.warn('XML parsererror', nodeErr.textContent);
      return [];
    }
    const items = Array.from(doc.querySelectorAll('item')).map(it => {
      const title = it.querySelector('title') ? it.querySelector('title').textContent : '';
      const link = it.querySelector('link') ? it.querySelector('link').textContent : (it.querySelector('guid') ? it.querySelector('guid').textContent : '#');
      const description = it.querySelector('description') ? it.querySelector('description').textContent : '';
      const contentEncoded = it.querySelector('content\\:encoded') ? it.querySelector('content\\:encoded').textContent : '';
      const content = contentEncoded || description;
      const pubDate = it.querySelector('pubDate') ? it.querySelector('pubDate').textContent : '';
      let image = '';
      const media = it.querySelector('media\\:content, media\\:thumbnail');
      if(media && media.getAttribute && media.getAttribute('url')) image = media.getAttribute('url');
      if(!image){
        const encl = it.querySelector('enclosure');
        if(encl && encl.getAttribute) image = encl.getAttribute('url') || '';
      }
      if(!image){
        const m = /<img[^>]+src=["']?([^"'>\s]+)["']?/i.exec(content || description || '');
        if(m) image = m[1];
      }
      return { title, link, content, description, pubDate, image };
    });
    return items;
  }

  async function fetchText(url){
    const res = await fetch(proxy(url));
    if(!res.ok) throw new Error('Network response not ok: ' + res.status);
    return await res.text();
  }

  function makeFeaturedCard(item){
    const container = document.createElement('div');
    container.className = 'gth-featured';

    const imgWrap = document.createElement('div');
    imgWrap.className = 'img';
    const aImg = document.createElement('a');
    aImg.href = item.link; aImg.target = '_blank'; aImg.rel = 'noopener noreferrer';
    const img = document.createElement('img');
    img.src = item.image || fallbackSvgDataUrl();
    img.alt = item.title || 'thumbnail';
    aImg.appendChild(img);
    imgWrap.appendChild(aImg);

    const meta = document.createElement('div');
    meta.className = 'meta';
    const headline = document.createElement('div');
    headline.className = 'headline';
    const aHead = document.createElement('a');
    aHead.href = item.link; aHead.target = '_blank'; aHead.rel = 'noopener noreferrer';
    aHead.style.textDecoration = 'none'; aHead.style.color = 'inherit';
    aHead.textContent = item.title || '';
    headline.appendChild(aHead);

    const syn = document.createElement('div');
    syn.className = 'syn';
    syn.textContent = catchy(item.title || '', item.content || item.description || '');

    const metaRow = document.createElement('div');
    metaRow.className = 'meta-row';
    const date = document.createElement('div');
    date.textContent = item.pubDate ? new Date(item.pubDate).toLocaleString() : '';
    const readWrap = document.createElement('div');
    const readA = document.createElement('a');
    readA.className = 'read';
    readA.href = item.link; readA.target = '_blank'; readA.rel = 'noopener noreferrer';
    readA.textContent = 'Read full';
    readWrap.appendChild(readA);

    metaRow.appendChild(date);
    metaRow.appendChild(readWrap);

    meta.appendChild(headline);
    meta.appendChild(syn);
    meta.appendChild(metaRow);

    container.appendChild(imgWrap);
    container.appendChild(meta);
    return container;
  }

  function makeSmallCard(item){
    const wrap = document.createElement('div');
    wrap.className = 'gth-sm';

    const thumb = document.createElement('div');
    thumb.className = 'thumb';
    const aThumb = document.createElement('a');
    aThumb.href = item.link; aThumb.target = '_blank'; aThumb.rel = 'noopener noreferrer';
    const img = document.createElement('img');
    img.src = item.image || fallbackSvgDataUrl();
    img.alt = item.title || 'thumb';
    aThumb.appendChild(img);
    thumb.appendChild(aThumb);

    const info = document.createElement('div');
    info.className = 'info';
    const h = document.createElement('div');
    h.className = 'h';
    const aH = document.createElement('a');
    aH.href = item.link; aH.target = '_blank'; aH.rel = 'noopener noreferrer';
    aH.style.textDecoration = 'none'; aH.style.color = 'inherit';
    aH.textContent = item.title || '';
    h.appendChild(aH);

    const s = document.createElement('div');
    s.className = 's';
    s.textContent = shortify(item.content || item.description || '', 110);

    info.appendChild(h);
    info.appendChild(s);

    wrap.appendChild(thumb);
    wrap.appendChild(info);
    return wrap;
  }

  try{
    loadingEl.textContent = 'Loading headlines…';
    const [newsText, trendsText] = await Promise.all([ fetchText(newsRSS), fetchText(trendsRSS) ]);
    const newsItems = parseRSS(newsText);
    const trendsItems = parseRSS(trendsText);

    const items = [];
    // prefer news first then trends
    for(const it of newsItems) items.push(it);
    for(const it of trendsItems) items.push(it);

    if(!items.length){
      contentEl.innerHTML = '<div class="gth-error">No items found — try again later.</div>';
      return;
    }

    items.sort((a,b) => (new Date(b.pubDate || 0) - new Date(a.pubDate || 0)));

    // create DOM structure
    contentEl.innerHTML = ''; // clear loading
    const featured = items[0];
    const smalls = items.slice(1, 1 + smallCount);

    contentEl.appendChild(makeFeaturedCard(featured));

    const grid = document.createElement('div');
    grid.className = 'gth-sm-grid';
    for(const s of smalls) grid.appendChild(makeSmallCard(s));
    contentEl.appendChild(grid);

    const footer = document.createElement('div');
    footer.className = 'gth-footer';
    footer.textContent = 'Powered by Google News & Trends';
    contentEl.appendChild(footer);

  }catch(err){
    console.error('Widget load error:', err);
    contentEl.innerHTML = '<div class="gth-error">Failed to load feeds (see console for details).</div>';
  }
})();
</script>
</body>
</html>
